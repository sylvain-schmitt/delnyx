{% extends 'pdf/base.html.twig' %}

{% block content %}
	<!-- En-tête -->
	<div class="header">
		<div class="company-info">
			<div class="company-logo">
				{% if logo_base64 %}
					<img src="{{ logo_base64 }}" alt="{{ company.raisonSociale ?? 'Logo' }}" style="height: 40px; width: auto;">
				{% else %}
					<span style="font-size: 24px; font-weight: bold; color: #2563eb; letter-spacing: 2px;">{{ company.raisonSociale ?? 'ENTREPRISE' }}</span>
				{% endif %}
			</div>
			<div class="company-details">
				{% if company %}
					<strong>{{ company.raisonSociale }}</strong><br>
					{% if not company.isTvaEnabled() %}
						<em>Micro-entrepreneur</em><br>
					{% endif %}
					{{ company.adresse }}<br>
					{{ company.codePostal }} {{ company.ville }}<br>
					{% if company.siret %}SIRET: {{ company.siret }}<br>{% endif %}
					{% if company.email %}Email: {{ company.email }}<br>{% endif %}
					{% if company.telephone %}Tél: {{ company.telephone }}{% endif %}
				{% else %}
					<strong>Entreprise</strong><br>
					Informations non disponibles
				{% endif %}
			</div>
		</div>
		<div class="document-info">
			<div class="document-title">FACTURE</div>
			<div class="document-number">{{ invoice.numero }}</div>
			<div class="document-date">
				Date: {{ invoice.dateCreation|date('d/m/Y') }}<br>
				{% if invoice.dateEcheance %}Échéance: {{ invoice.dateEcheance|date('d/m/Y') }}{% endif %}
			</div>
		</div>
	</div>

	<!-- Informations client -->
	<div class="client-section">
		<div class="client-info">
			<div class="section-title">Client</div>
			{% if client.companyName %}
				<div class="client-name">{{ client.companyName }}</div>
				<div class="client-details">
					<strong>{{ client.prenom }} {{ client.nom }}</strong><br>
			{% else %}
				<div class="client-name">{{ client.prenom }} {{ client.nom }}</div>
				<div class="client-details">
			{% endif %}
				{% if client.email %}{{ client.email }}<br>{% endif %}
				{% if client.telephone %}{{ client.telephone }}<br>{% endif %}
				{% if client.adresse %}
					{{ client.adresse }}<br>
					{{ client.codePostal }} {{ client.ville }}
				{% endif %}
				{% if client.siret %}<br>SIRET: {{ client.siret }}{% endif %}
			</div>
		</div>
		{% if invoice.quote %}
			<div class="company-billing">
				<div class="section-title">Référence devis</div>
				<div class="client-details">
					<strong>{{ invoice.quote.numero }}</strong><br>
					du {{ invoice.quote.dateCreation|date('d/m/Y') }}
				</div>
			</div>
		{% endif %}
	</div>

	<!-- Tableau des services -->
	<table class="services-table">
		<thead>
			<tr>
				<th style="width: 50%;">Description</th>
				<th style="width: 10%;" class="text-center">Quantité</th>
				<th style="width: 15%;" class="text-right">Prix unitaire</th>
				{% if company and company.isTvaEnabled() %}
					<th style="width: 10%;" class="text-right">TVA</th>
				{% endif %}
				<th style="width: 15%;" class="text-right">Total HT</th>
			</tr>
		</thead>
		<tbody>
			{% for line in invoice.lines %}
				<tr>
					<td><strong>{{ line.description }}</strong></td>
					<td class="text-center">{{ line.quantity }}</td>
					<td class="text-right">{{ line.unitPrice|number_format(2, ',', ' ') }} €</td>
					{% if company and company.isTvaEnabled() %}
						<td class="text-right">{{ line.tvaRate }} %</td>
					{% endif %}
					<td class="text-right">{{ line.totalHt|number_format(2, ',', ' ') }} €</td>
				</tr>
			{% endfor %}
		</tbody>
	</table>

	<!-- Totaux -->
	<div class="totals">
		<table class="totals-table">
			<tr>
				<td class="label">Total HT:</td>
				<td class="amount">{{ invoice.montantHTFormate }}</td>
			</tr>
			{% if company and company.isTvaEnabled() and invoice.montantTVA > 0 %}
				<tr>
					<td class="label">Total TVA:</td>
					<td class="amount">{{ invoice.montantTVAFormatted ?? (invoice.montantTVA|number_format(2, ',', ' ') ~ ' €') }}</td>
				</tr>
			{% endif %}
			<tr class="total-row">
				<td class="label">Total TTC:</td>
				<td class="amount">{{ invoice.montantTTCFormate }}</td>
			</tr>
			{% if invoice.montantAcompte > 0 %}
				<tr>
					<td class="label">Acompte versé:</td>
					<td class="amount">{{ invoice.montantAcompte|number_format(2, ',', ' ') }} €</td>
				</tr>
				<tr>
					<td class="label">Solde à payer:</td>
					<td class="amount">{{ (invoice.montantTTC - invoice.montantAcompte)|number_format(2, ',', ' ') }} €</td>
				</tr>
			{% endif %}
		</table>
	</div>

	<!-- Conditions de paiement -->
	{% if invoice.conditionsPaiement or invoice.penalitesRetard %}
		<div class="conditions-section">
			<div class="conditions-title">Conditions de paiement</div>
			<div class="conditions-content">
				{% if invoice.conditionsPaiement %}
					<strong>Paiement:</strong> {{ invoice.conditionsPaiement }}<br>
				{% endif %}
				{% if invoice.penalitesRetard %}
					<strong>Pénalités de retard:</strong> {{ invoice.penalitesRetard }}<br>
				{% endif %}
			</div>
		</div>
	{% endif %}

	{% if invoice.notes %}
		<div class="notes-section">
			<strong>Notes:</strong><br>
			{{ invoice.notes|nl2br }}
		</div>
	{% endif %}

	<!-- Mentions légales -->
	<div class="legal-mentions">
		<strong>Mentions légales:</strong><br>
		Facture émise le {{ invoice.dateCreation|date('d/m/Y') }}.<br>
		{% if invoice.dateEcheance %}Échéance: {{ invoice.dateEcheance|date('d/m/Y') }}.<br>{% endif %}
		{% if company and not company.isTvaEnabled() %}
			<strong>Micro-entrepreneur:</strong>
			TVA non applicable selon l'article 293 B du Code Général des Impôts.
		{% endif %}
	</div>

	<!-- Pied de page -->
	<div class="footer">
		{% if company %}
			<strong>{{ company.raisonSociale }}</strong>
			{% if company.email or company.telephone %}
				|
				{% if company. email %}{{ company.email }}{% endif %}
				{% if company.email and company.telephone %} | {% endif %}
				{% if company.telephone %}{{ company.telephone }}{% endif %}
			{% endif %}
		{% endif %}
	</div>
{% endblock %}
