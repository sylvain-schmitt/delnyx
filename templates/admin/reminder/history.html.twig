{% extends 'admin/layout/base.html.twig' %}
{% import 'admin/macros/pagination.html.twig' as pagination_macro %}

{% block title %}Historique des relances - Administration Delnyx
{% endblock %}

{% block page_title %}Historique des relances
{% endblock %}

{% block body %}
	<div
		class="space-y-6">

		{# Header #}
		<div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 scroll-animate">
			<div>
				<h1 class="text-2xl font-bold text-white">Historique des relances</h1>
				<p class="text-white/60 mt-1">{{ total_reminders }}
					relance{{ total_reminders > 1 ? 's' : '' }}
					envoyée{{ total_reminders > 1 ? 's' : '' }}</p>
			</div>
			<a href="{{ path('admin_reminder_index') }}" class="btn-secondary flex items-center gap-2">
				{{ ux_icon('lucide:arrow-left', {class: 'w-4 h-4'}) }}
				Retour aux règles
			</a>
		</div>

		{# Liste des relances #}
		{% if reminders|length > 0 %}
			<div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl overflow-hidden scroll-animate animate-delay-100">
				<div class="overflow-x-auto">
					<table class="w-full">
						<thead class="bg-white/5 border-b border-white/20">
							<tr>
								<th class="px-6 py-4 text-left text-xs font-semibold text-white/80 uppercase tracking-wider">Date</th>
								<th class="px-6 py-4 text-left text-xs font-semibold text-white/80 uppercase tracking-wider">Facture</th>
								<th class="px-6 py-4 text-left text-xs font-semibold text-white/80 uppercase tracking-wider">Règle</th>
								<th class="px-6 py-4 text-left text-xs font-semibold text-white/80 uppercase tracking-wider">Destinataire</th>
								<th class="px-6 py-4 text-left text-xs font-semibold text-white/80 uppercase tracking-wider">Statut</th>
							</tr>
						</thead>
						<tbody class="divide-y divide-white/10">
							{% for reminder in reminders %}
								<tr class="hover:bg-white/5 transition-colors duration-200">
									<td class="px-6 py-4 whitespace-nowrap">
										<div class="text-sm text-white">{{ reminder.createdAt|date('d/m/Y') }}</div>
										<div class="text-xs text-white/60">{{ reminder.createdAt|date('H:i') }}</div>
									</td>
									<td class="px-6 py-4 whitespace-nowrap">
										{% if reminder.invoice %}
											<a href="{{ path('admin_invoice_show', {id: reminder.invoice.id}) }}" class="text-sm font-medium text-blue-400 hover:text-blue-300">
												{{ reminder.invoice.numero }}
											</a>
											{% if reminder.invoice.client %}
												<div class="text-xs text-white/60">{{ reminder.invoice.client.nomComplet }}</div>
											{% endif %}
										{% else %}
											<span class="text-white/40">-</span>
										{% endif %}
									</td>
									<td class="px-6 py-4">
										{% if reminder.rule %}
											<div class="text-sm text-white">{{ reminder.rule.name }}</div>
											<div class="text-xs text-white/60">{{ reminder.rule.daysAfterDue }}j après échéance</div>
										{% else %}
											<span class="text-white/40">Règle supprimée</span>
										{% endif %}
									</td>
									<td class="px-6 py-4">
										<div class="text-sm text-white/80">{{ reminder.emailTo }}</div>
									</td>
									<td class="px-6 py-4 whitespace-nowrap">
										{% set statusColor = reminder.statusColor %}
										<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-{{ statusColor }}-500/20 text-{{ statusColor }}-300">
											{{ reminder.statusLabel }}
										</span>
										{% if reminder.errorMessage and reminder.status != 'sent' %}
											<div class="text-xs text-red-400 mt-1 max-w-xs truncate" title="{{ reminder.errorMessage }}">
												{{ reminder.errorMessage|slice(0, 50) }}...
											</div>
										{% endif %}
									</td>
								</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>

			{# Pagination #}
			{{ pagination_macro.render(current_page, total_pages, 'admin_reminder_history', {}, 20, total_reminders) }}
		{% else %}
			{# État vide #}
			<div class="text-center py-20 scroll-animate">
				<div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl p-12 max-w-md mx-auto">
					{{ ux_icon('lucide:mail-x', {class: 'w-16 h-16 text-gray-400 mb-6 mx-auto'}) }}
					<h3 class="text-2xl font-bold text-white mb-4">Aucune relance envoyée</h3>
					<p class="text-gray-300 mb-6">
						Les relances automatiques seront listées ici une fois envoyées.
					</p>
				</div>
			</div>
		{% endif %}

	</div>
{% endblock %}
