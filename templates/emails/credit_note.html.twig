{% extends 'emails/layout/base.html.twig' %}

{% block body %}
    <h1>Votre avoir est disponible</h1>

    <p>Bonjour {{ client.nomComplet }},</p>

    {% if customMessage %}
        <div class="custom-message">
            {{ customMessage|nl2br }}
        </div>
    {% else %}
        <p>Suite √† votre demande, veuillez trouver ci-joint votre avoir.</p>
    {% endif %}

    <div class="info-box">
        <p><strong>Num√©ro d'avoir :</strong> {{ creditNote.number }}</p>
        <p><strong>Facture associ√©e :</strong> {{ invoice.numero }}</p>
        <p><strong>Date d'√©mission :</strong> {{ creditNote.dateCreation|date('d/m/Y') }}</p>
        <p><strong>Montant de l'avoir :</strong> <span style="font-size: 18px; color: #1e293b;">{{ creditNote.montantTTCFormatted }}</span></p>
        {% if creditNote.reason %}
            <p><strong>Raison :</strong> {{ creditNote.reason }}</p>
        {% endif %}
    </div>

    {# Bouton d'action avec magic link #}
    <div style="text-align: center; margin: 30px 0;">
        <a href="{{ magic_link(creditNote, 'view') }}" style="display: inline-block; padding: 12px 24px; background-color: #3b82f6; color: white; text-decoration: none; border-radius: 6px; font-weight: 600; margin: 5px;">
            üëÅÔ∏è Voir l'avoir
        </a>
    </div>

    <div style="background-color: #f0f9ff; border-left: 4px solid #3b82f6; padding: 15px; margin: 30px 0;">
        <p style="margin: 0; color: #1e40af;">
            üìé <strong>L'avoir complet est √©galement disponible en pi√®ce jointe (PDF).</strong>
        </p>
    </div>

    {% if creditNote.stripeRefundId %}
        <div style="background-color: #f0fdf4; border-left: 4px solid #22c55e; padding: 15px; margin: 30px 0;">
            <p style="margin: 0; color: #166534;">
                ‚úÖ <strong>Bonne nouvelle :</strong> Un remboursement de {{ creditNote.montantTTCFormatted }} a √©t√© d√©clench√© sur votre carte bancaire Stripe. Les fonds appara√Ætront sur votre compte d'ici 5 √† 10 jours ouvr√©s.
            </p>
        </div>
    {% else %}
        <p>Cet avoir sera d√©duit de votre prochaine facture ou vous sera rembours√© selon les modalit√©s convenues.</p>
    {% endif %}

    <p style="margin-top: 30px;">
        Cordialement,<br>
        <strong>L'√©quipe Delnyx</strong>
    </p>
{% endblock %}


