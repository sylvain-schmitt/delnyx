{% extends 'admin/layout/base.html.twig' %}

{% block title %}Dashboard - Administration Delnyx
{% endblock %}

{% block page_title %}Dashboard
{% endblock %}

{% block body %}
	<div
		class="space-y-6">

		{# Stats Cards #}
		<div
			class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">

			{# Clients #}
			<div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl p-6 hover:bg-white/15 transition-all duration-300 scroll-animate">
				<div class="flex items-center justify-between">
					<div>
						<p class="text-white/60 text-sm font-medium">Clients</p>
						<p class="text-3xl font-bold text-white">{{ stats.clients|default(0) }}</p>
					</div>
					<div class="w-12 h-12 bg-blue-500/20 rounded-lg flex items-center justify-center">
						{{ ux_icon('lucide:users', {class: 'w-6 h-6 text-blue-400'}) }}
					</div>
				</div>
				<div class="mt-4">
					{% if growth.clients.direction == 'up' %}
						<span class="text-green-400 text-sm font-medium">+{{ growth.clients.percentage }}%</span>
					{% elseif growth.clients.direction == 'down' %}
						<span class="text-red-400 text-sm font-medium">-{{ growth.clients.percentage }}%</span>
					{% else %}
						<span class="text-white/60 text-sm font-medium">{{ growth.clients.percentage }}%</span>
					{% endif %}
					<span class="text-white/60 text-sm ml-2">vs mois dernier</span>
				</div>
			</div>

			{# Quotes #}
			<div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl p-6 hover:bg-white/15 transition-all duration-300 scroll-animate animate-delay-100">
				<div class="flex items-center justify-between">
					<div>
						<p class="text-white/60 text-sm font-medium">Devis</p>
						<p class="text-3xl font-bold text-white">{{ stats.quotes|default(0) }}</p>
					</div>
					<div class="w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center">
						{{ ux_icon('lucide:file-text', {class: 'w-6 h-6 text-green-400'}) }}
					</div>
				</div>
				<div class="mt-4">
					{% if growth.quotes.direction == 'up' %}
						<span class="text-green-400 text-sm font-medium">+{{ growth.quotes.percentage }}%</span>
					{% elseif growth.quotes.direction == 'down' %}
						<span class="text-red-400 text-sm font-medium">-{{ growth.quotes.percentage }}%</span>
					{% else %}
						<span class="text-white/60 text-sm font-medium">{{ growth.quotes.percentage }}%</span>
					{% endif %}
					<span class="text-white/60 text-sm ml-2">vs mois dernier</span>
				</div>
			</div>

			{# Invoices #}
			<div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl p-6 hover:bg-white/15 transition-all duration-300 scroll-animate animate-delay-200">
				<div class="flex items-center justify-between">
					<div>
						<p class="text-white/60 text-sm font-medium">Factures</p>
						<p class="text-3xl font-bold text-white">{{ stats.invoices|default(0) }}</p>
					</div>
					<div class="w-12 h-12 bg-purple-500/20 rounded-lg flex items-center justify-center">
						{{ ux_icon('lucide:credit-card', {class: 'w-6 h-6 text-purple-400'}) }}
					</div>
				</div>
				<div class="mt-4">
					{% if growth.invoices.direction == 'up' %}
						<span class="text-green-400 text-sm font-medium">+{{ growth.invoices.percentage }}%</span>
					{% elseif growth.invoices.direction == 'down' %}
						<span class="text-red-400 text-sm font-medium">-{{ growth.invoices.percentage }}%</span>
					{% else %}
						<span class="text-white/60 text-sm font-medium">{{ growth.invoices.percentage }}%</span>
					{% endif %}
					<span class="text-white/60 text-sm ml-2">vs mois dernier</span>
				</div>
			</div>

			{# CA Mensuel #}
			<div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl p-6 hover:bg-white/15 transition-all duration-300 scroll-animate animate-delay-300">
				<div class="flex items-center justify-between">
					<div>
						<p class="text-white/60 text-sm font-medium">CA Mensuel</p>
						<p class="text-3xl font-bold text-white">{{ stats.ca_mensuel|default(0)|number_format(0, ',', ' ') }}
							€</p>
					</div>
					<div class="w-12 h-12 bg-yellow-500/20 rounded-lg flex items-center justify-center">
						{{ ux_icon('lucide:euro', {class: 'w-6 h-6 text-yellow-400'}) }}
					</div>
				</div>
				<div class="mt-4">
					{% if growth.ca.direction == 'up' %}
						<span class="text-green-400 text-sm font-medium">+{{ growth.ca.percentage }}%</span>
					{% elseif growth.ca.direction == 'down' %}
						<span class="text-red-400 text-sm font-medium">-{{ growth.ca.percentage }}%</span>
					{% else %}
						<span class="text-white/60 text-sm font-medium">{{ growth.ca.percentage }}%</span>
					{% endif %}
					<span class="text-white/60 text-sm ml-2">vs mois dernier</span>
				</div>
			</div>
		</div>

		{# Graphique CA Mensuel #}
		<div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl p-6 scroll-animate">
			<h2 class="text-xl font-semibold text-white mb-6">Évolution du Chiffre d'Affaires</h2>
			<div class="relative w-full h-80">
				{{ render_chart(revenue_chart) }}
			</div>
		</div>

		{# Stats Avancées #}
		<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
			{# CA Annuel #}
			<div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl p-6 hover:bg-white/15 transition-all duration-300 scroll-animate">
				<div class="flex items-center justify-between">
					<div>
						<p class="text-white/60 text-sm font-medium">CA Annuel {{ "now"|date("Y") }}</p>
						<p class="text-3xl font-bold text-white">{{ advanced_stats.annual_revenue|default(0)|number_format(0, ',', ' ') }} €</p>
					</div>
					<div class="w-12 h-12 bg-emerald-500/20 rounded-lg flex items-center justify-center">
						{{ ux_icon('lucide:trending-up', {class: 'w-6 h-6 text-emerald-400'}) }}
					</div>
				</div>
				<div class="mt-4">
					{% set comparison = advanced_stats.yearly_comparison %}
					{% if comparison.direction == 'up' %}
						<span class="text-green-400 text-sm font-medium">+{{ comparison.growth }}%</span>
					{% elseif comparison.direction == 'down' %}
						<span class="text-red-400 text-sm font-medium">-{{ comparison.growth }}%</span>
					{% else %}
						<span class="text-white/60 text-sm font-medium">{{ comparison.growth }}%</span>
					{% endif %}
					<span class="text-white/60 text-sm ml-2">vs {{ "now"|date("Y") - 1 }}</span>
				</div>
			</div>

			{# Factures Impayées #}
			<div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl p-6 hover:bg-white/15 transition-all duration-300 scroll-animate animate-delay-100">
				<div class="flex items-center justify-between">
					<div>
						<p class="text-white/60 text-sm font-medium">Factures Impayées</p>
						<p class="text-3xl font-bold text-white">{{ advanced_stats.unpaid_invoices.total|default(0)|number_format(0, ',', ' ') }} €</p>
					</div>
					<div class="w-12 h-12 bg-orange-500/20 rounded-lg flex items-center justify-center">
						{{ ux_icon('lucide:alert-circle', {class: 'w-6 h-6 text-orange-400'}) }}
					</div>
				</div>
				<div class="mt-4">
					<span class="text-orange-400 text-sm font-medium">{{ advanced_stats.unpaid_invoices.count|default(0) }} facture(s)</span>
					<span class="text-white/60 text-sm ml-2">en attente</span>
				</div>
			</div>

			{# Taux de Conversion #}
			<div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl p-6 hover:bg-white/15 transition-all duration-300 scroll-animate animate-delay-200">
				<div class="flex items-center justify-between">
					<div>
						<p class="text-white/60 text-sm font-medium">Taux de Conversion</p>
						<p class="text-3xl font-bold text-white">{{ advanced_stats.conversion_rate.rate|default(0) }}%</p>
					</div>
					<div class="w-12 h-12 bg-cyan-500/20 rounded-lg flex items-center justify-center">
						{{ ux_icon('lucide:percent', {class: 'w-6 h-6 text-cyan-400'}) }}
					</div>
				</div>
				<div class="mt-4">
					<span class="text-cyan-400 text-sm font-medium">{{ advanced_stats.conversion_rate.signed|default(0) }}/{{ advanced_stats.conversion_rate.sent|default(0) }}</span>
					<span class="text-white/60 text-sm ml-2">devis signés</span>
				</div>
			</div>

			{# Comparaison Annuelle #}
			<div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl p-6 hover:bg-white/15 transition-all duration-300 scroll-animate animate-delay-300">
				<div class="flex items-center justify-between">
					<div>
						<p class="text-white/60 text-sm font-medium">CA {{ "now"|date("Y") - 1 }}</p>
						<p class="text-3xl font-bold text-white">{{ advanced_stats.yearly_comparison.previous_year|default(0)|number_format(0, ',', ' ') }} €</p>
					</div>
					<div class="w-12 h-12 bg-violet-500/20 rounded-lg flex items-center justify-center">
						{{ ux_icon('lucide:calendar', {class: 'w-6 h-6 text-violet-400'}) }}
					</div>
				</div>
				<div class="mt-4">
					<span class="text-white/60 text-sm">Année précédente</span>
				</div>
			</div>
		</div>

		{# Actions Rapides #}
		<div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl p-6 scroll-animate animate-delay-100">
			<h2 class="text-xl font-semibold text-white mb-6">Actions Rapides</h2>
			<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
				<a href="{{ path('admin_client_new') }}" class="flex items-center space-x-3 p-4 bg-white/5 hover:bg-white/10 rounded-lg transition-all duration-300 group">
					<div class="w-10 h-10 bg-blue-500/20 rounded-lg flex items-center justify-center group-hover:bg-blue-500/30 transition-colors duration-300">
						{{ ux_icon('lucide:user-plus', {class: 'w-5 h-5 text-blue-400'}) }}
					</div>
					<div>
						<p class="text-white font-medium">Nouveau Client</p>
						<p class="text-white/60 text-sm">Ajouter un client</p>
					</div>
				</a>
				<a href="{{ path('admin_quote_new') }}" class="flex items-center space-x-3 p-4 bg-white/5 hover:bg-white/10 rounded-lg transition-all duration-300 group">
					<div class="w-10 h-10 bg-green-500/20 rounded-lg flex items-center justify-center group-hover:bg-green-500/30 transition-colors duration-300">
						{{ ux_icon('lucide:file-plus', {class: 'w-5 h-5 text-green-400'}) }}
					</div>
					<div>
						<p class="text-white font-medium">Nouveau Devis</p>
						<p class="text-white/60 text-sm">Créer un devis</p>
					</div>
				</a>
				<a href="{{ path('admin_invoice_new') }}" class="flex items-center space-x-3 p-4 bg-white/5 hover:bg-white/10 rounded-lg transition-all duration-300 group">
					<div class="w-10 h-10 bg-purple-500/20 rounded-lg flex items-center justify-center group-hover:bg-purple-500/30 transition-colors duration-300">
						{{ ux_icon('lucide:receipt', {class: 'w-5 h-5 text-purple-400'}) }}
					</div>
					<div>
						<p class="text-white font-medium">Nouvelle Facture</p>
						<p class="text-white/60 text-sm">Créer une facture</p>
					</div>
				</a>
		</div>
	</div>

	{# Activité Récente #}
	<div
		class="grid grid-cols-1 lg:grid-cols-2 gap-6">

		{# Quotes Récents #}
		<div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl p-6 scroll-animate animate-delay-200">
			<div class="flex items-center justify-between mb-6">
				<h3 class="text-lg font-semibold text-white">Devis Récents</h3>
				<a href="{{ path('admin_quote_index') }}" class="text-blue-400 hover:text-blue-300 text-sm font-medium">
					Voir tout
				</a>
			</div>
			<div class="space-y-4">
				{% for quote in recent_quotes|default([]) %}
					<div class="flex items-center justify-between p-4 bg-white/5 rounded-lg">
						<div class="flex items-center space-x-3">
							<div class="w-10 h-10 bg-green-500/20 rounded-lg flex items-center justify-center">
								{{ ux_icon('lucide:file-text', {class: 'w-5 h-5 text-green-400'}) }}
							</div>
							<div>
								<p class="text-white font-medium">{{ quote.numero }}</p>
								<p class="text-white/60 text-sm">
									{% if quote.client.companyName %}
										{{ quote.client.companyName }} - {{ quote.client.prenom }} {{ quote.client.nom }}
									{% else %}
										{{ quote.client.prenom }} {{ quote.client.nom }}
									{% endif %}
								</p>
							</div>
						</div>
						<div class="text-right">
							<p class="text-white font-medium">{{ quote.montantTTCFormate }}</p>
							{% set status = quote.statut %}
							<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium
																										{% if status.value == 'draft' %}bg-gray-500/20 text-gray-300
																										{% elseif status.value == 'sent' %}bg-blue-500/20 text-blue-300
																										{% elseif status.value == 'signed' %}bg-green-500/20 text-green-300
																										{% elseif status.value == 'accepted' %}bg-green-500/20 text-green-300
																										{% elseif status.value == 'refused' %}bg-red-500/20 text-red-300
																										{% elseif status.value == 'expired' %}bg-yellow-500/20 text-yellow-300
																										{% elseif status.value == 'cancelled' %}bg-gray-600/20 text-gray-400
																										{% else %}bg-gray-500/20 text-gray-300{% endif %}">
								{{ status.label }}
							</span>
						</div>

					</div>
				{% endfor %}
			</div>
		</div>

		{# Invoices Récentes #}
		<div class="bg-white/10 backdrop-blur-xl border border-white/20 rounded-xl p-6 scroll-animate animate-delay-300">
			<div class="flex items-center justify-between mb-6">
				<h3 class="text-lg font-semibold text-white">Factures Récentes</h3>
				<a href="{{ path('admin_invoice_index') }}" class="text-blue-400 hover:text-blue-300 text-sm font-medium">
					Voir tout
				</a>
			</div>
			<div class="space-y-4">
				{% for invoice in recent_invoices|default([]) %}
					<div class="flex items-center justify-between p-4 bg-white/5 rounded-lg">
						<div class="flex items-center space-x-3">
							<div class="w-10 h-10 bg-purple-500/20 rounded-lg flex items-center justify-center">
								{{ ux_icon('lucide:credit-card', {class: 'w-5 h-5 text-purple-400'}) }}
							</div>
							<div>
								<p class="text-white font-medium">{{ invoice.numero }}</p>
								<p class="text-white/60 text-sm">
									{% if invoice.client.companyName %}
										{{ invoice.client.companyName }} - {{ invoice.client.prenom }} {{ invoice.client.nom }}
									{% else %}
										{{ invoice.client.prenom }} {{ invoice.client.nom }}
									{% endif %}
								</p>
							</div>
						</div>
						<div class="text-right">
							<p class="text-white font-medium">{{ invoice.montantTTCFormate }}</p>
							{% set status = invoice.statutEnum %}
							<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium
																										{% if status.value == 'draft' %}bg-gray-500/20 text-gray-300
																										{% elseif status.value == 'issued' %}bg-blue-500/20 text-blue-300
																										{% elseif status.value == 'sent' %}bg-purple-500/20 text-purple-300
																										{% elseif status.value == 'paid' %}bg-green-500/20 text-green-300
																										{% elseif status.value == 'cancelled' %}bg-gray-600/20 text-gray-400
																										{% else %}bg-gray-500/20 text-gray-300{% endif %}">
								{{ status.label }}
							</span>
						</div>
					</div>
				{% endfor %}
			</div>
		</div>
	</div>
</div>{% endblock %}
